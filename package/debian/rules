#!/usr/bin/make -f

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/makefile.mk

HEAPSIZE := $(shell . debian/heap-size)

# MLton compiles optimized, debug, and pic versions on its own.
DEB_MAKE_INVOKE = $(DEB_MAKE_ENVVARS) make -C $(DEB_BUILDDIR)

DEB_MAKE_CLEAN_TARGET   = clean clean-svn
DEB_MAKE_BUILD_TARGET   = all RUNTIME_ARGS="fixed-heap $(HEAPSIZE)" VERSION=$(DEB_VERSION)
DEB_MAKE_INSTALL_TARGET = install-no-strip DESTDIR=$(CURDIR)/debian/tmp/ PREFIX=/usr MAN_PREFIX_EXTRA=/share
DEB_MAKE_CHECK_TARGET   = check

# Useful when inspecting build logs
common-configure-arch::
	free

# Remove empty directories to appease lintian
common-install-arch::
	find path/to/base/dir -type d -empty -delete
