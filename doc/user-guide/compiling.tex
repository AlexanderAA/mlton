\sec{Compiling {\mlton}}{compiling}

If you want to compile {\mlton}, you need either the source {\tt rpm} or {\tt
tgz}.  You can compile with either {\mlton} or {\smlnj}.

\subsection{Compiling with {\mlton}}

To compile with {\mlton}, you need binary versions of {\tt mlton},
{\tt mllex}, and {\tt mlyacc} that come with a {\mlton} binary {\tt
rpm} or {\tt tgz} (an older or newer version of {\mlton} should work).
To compile, run {\tt make} from within the {\tt src} directory.
\begin{verbatim}
% make
mlyacc front-end/ml.grm
1 shift/reduce conflict
mllex front-end/ml.lex

Number of states = 278
Number of distinct rows = 183
Approx. memory size of trans. table = 188856 bytes
Compiling mlton (takes a while)
time mlton @MLton -- -v -o mlton-compile mlton-stubs.cm
MLton starting
   Compile SML starting
      pre codegen starting
...
\end{verbatim}
This calls {\tt mlyacc} and {\tt mllex} to build the parser and lexer, and then
calls {\tt mlton} to compile itself.  If you make {\mlton} using another version
of {\mlton}, then the Makefile will automatically use {\tt mlton-stubs.cm},
which will put in enough stubs to emulate the {\tt MLton} structure.  Once you
have successfully built {\mlton}, you should recompile it with itself, which
will use {\tt mlton.cm} to bypass the stubs and use the real {\tt MLton}
structure from the basis library.

Compiling {\mlton} requires at least 400m of memory.  Thus, if your machine has
less than 512m, it is likely that self-compilation will take a very long time
due to paging.  Even if you have enough memory, there simply may not be enough
available, due to memory consumed by other processes.  In this case, you will
likely see the following error during self-compilation.
\begin{verbatim}
Out of swap space
\end{verbatim}
The only fix is to make sure that enough virtual memory is available.

\subsection{Compiling with {\smlnj}}

To compile with {\smlnj} version 110.35 or later, run {\tt make nj-mlton} from
within the {\tt mlton} subdirectory of the sources.
\begin{verbatim}
% make nj-mlton
(                                                                       \
        echo 'SMLofNJ.Internals.GC.messages false;';                    \
...
)
...
Standard ML of New Jersey v110.37 [FLINT v1.5], November 21, 2001
...
write 5,0: 271 big objects (6473 pages) @ 0x4fd000
\end{verbatim}
